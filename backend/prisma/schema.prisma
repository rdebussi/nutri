// Schema do banco de dados do Nutri
// Cada "model" aqui vira uma tabela no PostgreSQL
// e um tipo TypeScript gerado automaticamente

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ============================================
// MODEL: User
// ============================================
// Representa um usuário da plataforma.
// Separamos dados de autenticação (email, password)
// dos dados de perfil nutricional (NutritionProfile).
// Por quê? Porque são responsabilidades diferentes:
// - User = "quem é você" (auth)
// - NutritionProfile = "como é seu corpo" (negócio)

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String   // hash bcrypt, NUNCA texto puro
  name      String
  role      Role     @default(FREE)
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  profile NutritionProfile?

  @@map("users") // nome da tabela no PostgreSQL
}

// ============================================
// ENUM: Role
// ============================================
// Define os planos de acesso do usuário.
// FREE = funcionalidades limitadas
// PRO = tudo liberado (paga via Stripe)
// ADMIN = nós, administradores

enum Role {
  FREE
  PRO
  ADMIN
}

// ============================================
// MODEL: NutritionProfile
// ============================================
// Perfil nutricional do usuário. Esses dados
// serão enviados à OpenAI para gerar dietas.
// Cada campo tem uma razão:
// - weight/height → cálculo de IMC e taxa metabólica
// - goal → o que a IA deve otimizar na dieta
// - restrictions → alimentos que a IA deve evitar
// - activityLevel → ajuste calórico

model NutritionProfile {
  id             String        @id @default(uuid())
  userId         String        @unique @map("user_id")
  birthDate      DateTime?     @map("birth_date")
  gender         Gender?
  weight         Float?        // em kg
  height         Float?        // em cm
  goal           Goal?
  activityLevel  ActivityLevel? @map("activity_level")
  restrictions   String[]      // ex: ["glúten", "lactose"]
  createdAt      DateTime      @default(now()) @map("created_at")
  updatedAt      DateTime      @updatedAt @map("updated_at")

  user      User               @relation(fields: [userId], references: [id], onDelete: Cascade)
  routines  ExerciseRoutine[]

  @@map("nutrition_profiles")
}

enum Gender {
  MALE
  FEMALE
  OTHER
}

enum Goal {
  LOSE_WEIGHT
  GAIN_MUSCLE
  MAINTAIN
  HEALTH
}

enum ActivityLevel {
  SEDENTARY
  LIGHT
  MODERATE
  ACTIVE
  VERY_ACTIVE
}

// ============================================
// MODEL: ExerciseRoutine
// ============================================
// Rotina semanal de exercícios do usuário.
// Cada registro é um exercício que o usuário faz
// regularmente (ex: musculação 4x/semana, 60min).
// Esses dados são usados para calcular o TDEE real
// e gerar dietas mais precisas.

model ExerciseRoutine {
  id              String    @id @default(uuid())
  profileId       String    @map("profile_id")
  exerciseName    String    @map("exercise_name")
  category        String
  met             Float
  daysPerWeek     Int       @map("days_per_week")
  durationMinutes Int       @map("duration_minutes")
  intensity       Intensity @default(MODERATE)
  createdAt       DateTime  @default(now()) @map("created_at")
  updatedAt       DateTime  @updatedAt @map("updated_at")

  profile NutritionProfile @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@map("exercise_routines")
}

enum Intensity {
  LIGHT
  MODERATE
  INTENSE
}
